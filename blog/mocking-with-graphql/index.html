<!DOCTYPE html><html><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/><title>Mocking your server is easy with GraphQL | GraphQL</title><meta name="viewport" content="width=640"/><meta property="og:title" content="GraphQL: A query language for APIs."/><meta property="og:description" content="GraphQL provides a complete description of the data in your API, gives clients the power to ask for exactly what they need and nothing more, makes it easier to evolve APIs over time, and enables powerful developer tools."/><meta property="og:type" content="website"/><meta property="og:url" content="http://graphql.org/"/><meta property="og:image" content="/img/og_image.png"/><meta property="og:image:type" content="image/png"/><meta name="twitter:card" content="summary"/><meta name="twitter:site" content="@graphql"/><meta name="twitter:title" content="GraphQL: A query language for APIs."/><meta name="twitter:description" content="GraphQL gives clients the power to ask for exactly what they need and nothing more, making it easier to evolve APIs over time."/><meta name="twitter:image" content="/img/twitter_image.png"/><link rel="shortcut icon" href="/img/favicon.png"/><link rel="home" type="application/rss+xml" href="/blog/rss.xml" title="GraphQL Team Blog"/><link rel="stylesheet" href="/style.css"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Rubik:300|Roboto:300"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,400i,600"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/></head><body><header><section><a class="nav-home" href="/"><img class="nav-logo" src="/img/logo.svg" width="30" height="30"/>GraphQL</a><nav><a href="/learn/">学习</a><a href="/code/">代码</a><a href="/community/">社区</a><a href="/blog/" class="active">博客</a><a href="http://facebook.github.io/graphql/" target="_blank" rel="noopener noreferrer">定义</a><a href="https://github.com/willin/graphql.js.cool/issues/1" target="_blank" rel="noopener noreferrer">翻译纠错</a></nav><div class="algolia-search-wrapper"><input type="text" id="algolia-search-input" placeholder="搜索文档..."/></div></section></header><section><div class="documentationContent"><div class="inner-content"><h1>Mocking your server is easy with GraphQL</h1><p>4/19/2016 by Jonas Helfer</p><p class="guestBio">This guest article contributed by Jonas Helfer, engineer at Meteor working on Apollo.</p><div><p>Do you think mocking your backend is always a tedious task? If you do, reading this post might change your mind…</p><p>Mocking is the practice of creating a fake version of a component, so that you can develop and test other parts of your application independently. Mocking your backend is a great way to quickly build a prototype of your frontend, and it lets you test your frontend without starting up any servers. API mocking is so useful that a <a href="https://www.google.com/?ion=1&amp;espv=2#q=mock+rest+api" target="_blank" rel="nofollow noopener noreferrer">quick Google search</a> will turn up dozens of expensive products and services that promise to help you.</p><p>Sadly, I think none of the solutions out there make it as easy as it should be. As it turns out, that’s because they’ve been trying to do it with the wrong technology!</p><blockquote><p>Editor’s note : The concepts in this post are accurate, but some the code samples don’t demonstrate new usage patterns. After reading, consult the <a href="http://dev.apollodata.com/tools/graphql-tools/mocking.html" target="_blank" rel="nofollow noopener noreferrer">graphql-tools docs</a> to see how to use mocking today.</p></blockquote><h2><a class="anchor" name="why-mock"></a>Why mock? <a class="hash-link" href="#why-mock">#</a></h2><p>Mocking the data a backend would return is very useful for two main reasons:</p><ol><li>It lets you start developing a frontend feature when you don’t have a working backend for it yet. This is critical for projects where the frontend and backend components are often developed in parallel.</li><li>It lets you run tests locally without connecting to a real backend, which is much faster and safer. As your codebase grows and your app becomes more complex, starting up all of the server infrastructure just to run some tests isn’t feasible.</li></ol><p>If mocking your backend API has such clear benefits, why doesn’t everyone do it? I think it&#x27;s because mocking often seems like too much trouble to be worth it.</p><h2><a class="anchor" name="why-is-mocking-backends-hard"></a>Why is mocking backends hard? <a class="hash-link" href="#why-is-mocking-backends-hard">#</a></h2><p>Let’s say your backend is some REST API that is called over HTTP from the browser. You have someone working on the backend, and someone else working on the frontend. The backend code actually determines the shape of the data returned for each REST endpoint, but mocking has to be done in the frontend code. That means the mocking code will break every time the backend changes, unless both are changed at the same time. What’s worse, if you’re doing your frontend testing against a mock backend that is not up to date with your backend, your tests may pass, but your actual frontend won’t work.</p><p>Rather than having to keep more dependencies up to date, the easy option is to just not mock the REST API, or have the backend be in charge of mocking itself, just so it’s all in one place. That may be easier, but it will also slow you down.</p><p>The other reason I often hear for why people don’t mock the backend in their project is because it takes time to set up: first you have to include extra logic in your data fetching layer that lets you turn mocking on and off, and second you have to actually describe what that mock data should look like. For any non-trivial API that requires a lot of tedious work.</p><p>Both of these reasons for why mocking backends is hard are actually due to the same underlying reason: there is no standard REST API description in machine-consumable format and contains all the information necessary for mocking and can be used by both the backend and the frontend. There are some API description standards, like Swagger, but they don’t contain all of the information you need, and can be cumbersome to write and maintain. Unless you want to pay for a service or a product — and maybe even then — mocking is a lot of work.</p><p>Actually, I should say mocking used to be a lot of work, because a new technology is changing the way we think of APIs: GraphQL.</p><h2><a class="anchor" name="mocking-is-easy-with-a-type-system"></a>Mocking is easy with a type system! <a class="hash-link" href="#mocking-is-easy-with-a-type-system">#</a></h2><p>GraphQL makes mocking easy, because every GraphQL backend comes with a static type system. The types can be shared between your backend and your frontend, and they contain all of the information necessary to make mocking incredibly fast and convenient. With GraphQL, there is no excuse to not mock your backend for development or testing.</p><p>Here’s how easy it is to create a mocked backend that will accept any valid GraphQL query with the GraphQL mocking tool we are building as part of our new <a href="https://github.com/apollostack/graphql-tools" target="_blank" rel="nofollow noopener noreferrer">GraphQL server toolkit</a>:</p><div><script src="https://gist.github.com/helfer/586e32a2852059cc5e7d6889ea771ed1.js"></script>

</div><p>Every GraphQL server needs a schema, so it’s not extra code you need to write just for mocking. And the query is the one your component already uses for fetching data, so that’s also not code you write just for mocking. Not counting the import statement, it only took us one line of code to mock the entire backend!</p><p>Put that in contrast to most REST APIs out there, where mocking means parsing a URL and returning data in a custom shape for each endpoint. It takes dozens of lines to mock a single endpoint that returns some realistic-looking data. With GraphQL, the shape is encoded in the query, and together with the schema we have enough information to mock the server with a single line of code.</p><p>Did I mention that this one line is all you need to return mock data for any valid GraphQL query you could send? Not just some valid query, any valid query! Pretty cool, right?</p><h2><a class="anchor" name="customizing-mock-data"></a>Customizing mock data <a class="hash-link" href="#customizing-mock-data">#</a></h2><p>In the example above, the mock server will return completely random IDs and strings every time you query it. When you’ve just started building your app and only want to see what your UI code looks like in different states, that’s probably good enough, but as you start to fine-tune your layout, or want to use the mock server to test your component’s logic, you’ll probably need more realistic data.</p><p>Luckily, this takes only a little more effort: customization of mock data is really where the Apollo mocking tool shines, because it lets you customize virtually everything about the mock data that it returns.</p><p>It lets you do all of the following and more:</p><div><script src="https://gist.github.com/helfer/fa8a5788845366d5052f8677d6338bae.js"></script>

</div><p>For each type and each field you can provide a function that will be called on to generate mock data. Mock functions on fields have precedence over mock functions on types, but they work together really nicely: The field mock functions only need to describe the properties of the objects that matter to them, type mock functions will fill in the rest.</p><p>The mock functions are actually just GraphQL resolve functions in disguise. What that means is that your mocking can do anything that you could do inside a GraphQL resolve function. If you wanted, you could write your entire backend with it. I’m not saying you should, but you could.</p><p>I think the real power of this tool is that while it allows almost arbitrarily complex customization, you can get started really quickly and increase the sophistication of your mocks in tiny steps whenever you need it. Each step is so simple that it will feel like a breeze.</p><p>But enough talking, here’s a complete example:</p><div><script src="https://gist.github.com/helfer/c7bbf659bdaeb36d4f8a389e39a7a5fa.js"></script>

</div><h2><a class="anchor" name="live-demo-try-it-yourself"></a>Live demo + try it yourself <a class="hash-link" href="#live-demo-try-it-yourself">#</a></h2><p>To see the example in action and see what output it generates, head over to the <a href="https://launchpad.graphql.com/98lq7vz8r" target="_blank" rel="nofollow noopener noreferrer">live demo</a> try running some queries!</p><p>If you want to fiddle around with the example, just click the &quot;Download&quot; button in the Launchpad UI. If you’re curious about how it works or want to see what other tools we’re building for GraphQL, then head over to <a href="https://github.com/apollostack/graphql-tools" target="_blank" rel="nofollow noopener noreferrer">apollostack/graphql-tools</a>.</p><p>Pretty cool, right? All of that becomes possible by using a type system. And that’s only just the beginning — we‘re working on bridging the gap between mocking and the real thing so that your mock server can gradually turn into your real server as you add more functionality to it.</p><hr/><p><em>This post was originally published on <a href="https://medium.com/apollo-stack" target="_blank" rel="nofollow noopener noreferrer">the Apollo Blog</a>. We publish one or two posts every week, about the stuff we’re working on and thinking about.</em></p></div></div><div class="nav-docs"><div class="nav-docs-section"><h3>订阅</h3><a rel="home" type="application/rss+xml" href="/blog/rss.xml">RSS</a></div><div class="nav-docs-section"><h3>最新文章</h3><ul><li><a href="/blog/production-ready/">Leaving technical preview</a></li><li><a href="/blog/rest-api-graphql-wrapper/">Wrapping a REST API in GraphQL</a></li><li>Mocking your server is easy with GraphQL</li><li><a href="/blog/subscriptions-in-graphql-and-relay/">Subscriptions in GraphQL and Relay</a></li><li><a href="/blog/graphql-a-query-language/">GraphQL: A data query language</a></li></ul></div></div></div></section><footer><section class="sitemap"><a href="/" class="nav-home"></a><div><h5><a href="/learn/">学习</a></h5><a href="/learn/">介绍</a><a href="/learn/queries/">查询语言</a><a href="/learn/schema/">类型系统</a><a href="/learn/execution/">执行</a><a href="/learn/best-practices/">最佳实践</a></div><div><h5><a href="/code">代码</a></h5><a href="/code/#server-libraries">服务端</a><a href="/code/#graphql-clients">客户端</a><a href="/code/#tools">工具</a></div><div><h5><a href="/community">社区</a></h5><a href="/community/upcoming-events/">最新事件</a><a href="http://stackoverflow.com/questions/tagged/graphql" target="_blank" rel="noopener noreferrer">Stack Overflow</a><a href="https://www.facebook.com/groups/graphql.community/" target="_blank" rel="noopener noreferrer">Facebook 群组</a><a href="https://twitter.com/GraphQL" target="_blank" rel="noopener noreferrer">Twitter</a></div><div><h5>更多</h5><a href="/blog">GraphQL 团队博客</a><a href="http://facebook.github.io/graphql/" target="_blank" rel="noopener noreferrer">阅读定义</a><a href="https://github.com/graphql" target="_blank" rel="noopener noreferrer">GitHub</a><a href="https://github.com/willin/graphql.js.cool/edit/cn/site/blog/20160419-mocking.md" target="_blank" rel="noopener noreferrer">翻译该页面 ✎</a></div></section><a href="https://code.facebook.com/projects/" target="_blank" rel="noopener noreferrer" class="fbOpenSource"><img src="/img/oss_logo.png" alt="Facebook Open Source" width="170" height="45"/></a><section class="copyright">Copyright © 2016 Facebook Inc. The contents of this page are licensed BSD-3-Clause. <br/>译者: <a href="https://willin.wang/" target="_blank">Willin Wang</a></section></footer><script src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
        docsearch({
          apiKey: '9177558dc6ad5e773ed3fb2d3e6f9099',
          appId: 'J0T213YR6H',
          indexName: 'graphql',
          inputSelector: '#algolia-search-input'
        });
      </script><script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-33096931-4', 'auto');
ga('send', 'pageview');
      </script></body></html>